
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.2.4
  creationTimestamp: null
  name: controlplanes.pipecd.kanatakita.com
spec:
  group: pipecd.kanatakita.com
  names:
    kind: ControlPlane
    listKind: ControlPlaneList
    plural: controlplanes
    singular: controlplane
  scope: Namespaced
  subresources:
    status: {}
  validation:
    openAPIV3Schema:
      description: ControlPlane is the Schema for the controlplanes API
      properties:
        apiVersion:
          description: 'APIVersion defines the versioned schema of this representation
            of an object. Servers should convert recognized schemas to the latest
            internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
          type: string
        kind:
          description: 'Kind is a string value representing the REST resource this
            object represents. Servers may infer this from the endpoint the client
            submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
          type: string
        metadata:
          type: object
        spec:
          description: ControlPlaneSpec defines all configuration for all control-plane
            components.
          properties:
            config:
              description: Config is ControlPlane configuration of PipeCD
              properties:
                address:
                  description: The address to the control plane. This is required
                    if SSO is enabled.
                  format: string
                  type: string
                cache:
                  description: The configuration of cache for control plane.
                  properties:
                    ttl:
                      format: int64
                      type: integer
                  required:
                  - ttl
                  type: object
                datastore:
                  description: The configuration of datastore for control plane
                  properties:
                    dynamoDbConfig:
                      description: The configuration in the case of Amazon DynamoDB.
                      type: object
                    firestoreConfig:
                      description: The configuration in the case of Cloud Firestore.
                      type: object
                    mongoDBConfig:
                      description: The configuration in the case of general MongoDB.
                      properties:
                        database:
                          description: The name of the database.
                          format: string
                          type: string
                        passwordFile:
                          description: The path to the password file. For those who
                            don't want to include the password in the URL.
                          format: string
                          type: string
                        url:
                          description: The url of MongoDB. All of credentials can
                            be specified via this field.
                          format: string
                          type: string
                        usernameFile:
                          description: The path to the username file. For those who
                            don't want to include the username in the URL.
                          format: string
                          type: string
                      required:
                      - database
                      - url
                      type: object
                  type: object
                filestore:
                  description: The configuration of filestore for control plane.
                  properties:
                    gcsConfig:
                      description: The configuration in the case of Google Cloud Storage.
                      type: object
                    minioConfig:
                      description: The configuration in the case of Minio.
                      properties:
                        accessKeyFile:
                          description: The path to the access key file.
                          format: string
                          type: string
                        autoCreateBucket:
                          description: Whether the given bucket should be made automatically
                            if not exists.
                          format: bool
                          type: boolean
                        bucket:
                          description: The bucket name to store.
                          format: string
                          type: string
                        endpoint:
                          description: The address of Minio.
                          format: string
                          type: string
                        secretKeyFile:
                          description: The path to the secret key file.
                          format: string
                          type: string
                      required:
                      - accessKeyFile
                      - bucket
                      - endpoint
                      - secretKeyFile
                      type: object
                    s3Config:
                      description: The configuration in the case of Amazon S3.
                      type: object
                  type: object
                projects:
                  description: List of debugging/quickstart projects defined in Control
                    Plane configuration. Please note that do not use this to configure
                    the projects running in the production.
                  items:
                    properties:
                      desc:
                        description: The description about the project.
                        format: string
                        type: string
                      id:
                        description: The unique identifier of the project.
                        format: string
                        type: string
                      staticAdmin:
                        description: Static admin account of the project.
                        properties:
                          passwordHash:
                            description: The bcrypt hashsed value of the password
                              string.
                            format: string
                            type: string
                          username:
                            description: The username string.
                            format: string
                            type: string
                        required:
                        - passwordHash
                        - username
                        type: object
                    required:
                    - id
                    type: object
                  type: array
                sharedSSOConfigs:
                  description: List of shared SSO configurations that can be used
                    by any projects.
                  items:
                    properties:
                      github:
                        properties:
                          baseUrl:
                            format: string
                            type: string
                          clientId:
                            format: string
                            type: string
                          clientSecret:
                            format: string
                            type: string
                          uploadUrl:
                            format: string
                            type: string
                        required:
                        - baseUrl
                        - clientId
                        - clientSecret
                        - uploadUrl
                        type: object
                      google:
                        properties:
                          clientId:
                            format: string
                            type: string
                          clientSecret:
                            format: string
                            type: string
                        required:
                        - clientId
                        - clientSecret
                        type: object
                      name:
                        format: string
                        type: string
                    required:
                    - github
                    - google
                    - name
                    type: object
                  type: array
                stateKey:
                  description: A randomly generated string used to sign oauth state.
                  format: string
                  type: string
              type: object
            envoyVersion:
              description: version of github.com/envoyproxy/envoy
              format: string
              type: string
            minioVersion:
              description: version of docker.io/minio/minio
              format: string
              type: string
            redisVersion:
              description: version of docker.io/redis
              format: string
              type: string
            replicasApi:
              description: number of replicas of api
              format: int32
              minimum: 0
              type: integer
            replicasCache:
              description: number of replicas of cache
              format: int32
              minimum: 0
              type: integer
            replicasGateway:
              description: number of replicas of gateway
              format: int32
              minimum: 0
              type: integer
            replicasOps:
              description: number of replicas of ops
              format: int32
              minimum: 0
              type: integer
            replicasWeb:
              description: number of replicas of web
              format: int32
              minimum: 0
              type: integer
            secret:
              description: secret for PipeCD EncryptionKey & Minio AccessKey and SecretKey
              properties:
                defaultMode:
                  description: 'Optional: mode bits to use on created files by default.
                    Must be a value between 0 and 0777. Defaults to 0644. Directories
                    within the path are not affected by this setting. This might be
                    in conflict with other options that affect the file mode, like
                    fsGroup, and the result can be other mode bits set.'
                  format: int32
                  type: integer
                items:
                  description: If unspecified, each key-value pair in the Data field
                    of the referenced Secret will be projected into the volume as
                    a file whose name is the key and content is the value. If specified,
                    the listed keys will be projected into the specified paths, and
                    unlisted keys will not be present. If a key is specified which
                    is not present in the Secret, the volume setup will error unless
                    it is marked optional. Paths must be relative and may not contain
                    the '..' path or start with '..'.
                  items:
                    description: Maps a string key to a path within a volume.
                    properties:
                      key:
                        description: The key to project.
                        type: string
                      mode:
                        description: 'Optional: mode bits to use on this file, must
                          be a value between 0 and 0777. If not specified, the volume
                          defaultMode will be used. This might be in conflict with
                          other options that affect the file mode, like fsGroup, and
                          the result can be other mode bits set.'
                        format: int32
                        type: integer
                      path:
                        description: The relative path of the file to map the key
                          to. May not be an absolute path. May not contain the path
                          element '..'. May not start with the string '..'.
                        type: string
                    required:
                    - key
                    - path
                    type: object
                  type: array
                optional:
                  description: Specify whether the Secret or its keys must be defined
                  type: boolean
                secretName:
                  description: 'Name of the secret in the pod''s namespace to use.
                    More info: https://kubernetes.io/docs/concepts/storage/volumes#secret'
                  type: string
              type: object
            version:
              description: version of gcr.io/pipecd/api & gcr.io/pipecd/web & gcr.io/pipecd/ops
              format: string
              type: string
          required:
          - secret
          - version
          type: object
        status:
          description: ControlPlaneStatus defines the observed state of ControlPlane
          properties:
            availableApiReplicas:
              description: this is equal deployment.status.availableReplicas of api
              format: int32
              type: integer
            availableCacheReplicas:
              description: this is equal deployment.status.availableReplicas of cache
              format: int32
              type: integer
            availableGatewayReplicas:
              description: this is equal deployment.status.availableReplicas of gateway
              format: string
              type: integer
            availableMinioReplicas:
              description: this is equal deployment.status.availableReplicas of minio
              format: int32
              type: integer
            availableOpsReplicas:
              description: this is equal deployment.status.availableReplicas of ops
              format: int32
              type: integer
            availableWebReplicas:
              description: this is equal deployment.status.availableReplicas of web
              format: int32
              type: integer
          required:
          - availableApiReplicas
          - availableCacheReplicas
          - availableGatewayReplicas
          - availableMinioReplicas
          - availableOpsReplicas
          - availableWebReplicas
          type: object
      type: object
  version: v1alpha1
  versions:
  - name: v1alpha1
    served: true
    storage: true
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
